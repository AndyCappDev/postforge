%% PackedArray tests

userdict /$unittest known not {(unit_tests/unittest.ps) run} if


%% packedarray %%
1 2 3 3 /packedarray [[1 2 3]] assert
0 /packedarray [[]] assert
    % packedarray errors
    /packedarray [/stackunderflow] assert
    (a) /packedarray [(a) /typecheck] assert
    1 /packedarray [1 /stackunderflow] assert
    (a) (b) 2 true setglobal /packedarray [(a) (b) 2 /invalidaccess] assert
    false setglobal


%% currentpacking and setpacking
/currentpacking [false] assert
true setpacking /currentpacking [true] assert
false setpacking /currentpacking [false] assert
    % setpacking errors
    /setpacking [/stackunderflow] assert
    (a) /setpacking [(a) /typecheck] assert
    1 /setpacking [1 /typecheck] assert


%% length %%
1 2 3 3 packedarray /length [3] assert
    % length errors
    /length [/stackunderflow] assert
    1 /length [1 /typecheck] assert


%% get %%
31 41 59 3 packedarray 0 /get [31] assert
0 (string) [] {add 2 div} 4 packedarray 2 /get [[]] assert
    % get errors
    /get [/stackunderflow] assert
    31 41 59 3 packedarray 1.0 /get [[31 41 59] 1.0 /typecheck] assert
    31 41 59 3 packedarray -1 /get [[31 41 59] -1 /rangecheck] assert
    31 41 59 3 packedarray 3 /get [[31 41 59] 3 /rangecheck] assert
    %[31 41 59] noaccess 0 /get [[31 41 59] 0 /invalidaccess] assert


%% getinterval %%
9 8 7 6 5 5 packedarray 1 3 /getinterval [[8 7 6]] assert
    % getinterval errors
    5 -1 3 /getinterval [5 -1 3 /typecheck] assert
    9 8 7 6 5 5 packedarray (a) 3 /getinterval [[9 8 7 6 5] (a) 3 /typecheck] assert
    9 8 7 6 5 5 packedarray 1 (a) /getinterval [[9 8 7 6 5] 1 (a) /typecheck] assert
    9 8 7 6 5 5 packedarray -1 3 /getinterval [[9 8 7 6 5] -1 3 /rangecheck] assert
    9 8 7 6 5  5 packedarray 0 6 /getinterval [[9 8 7 6 5] 0 6 /rangecheck] assert


%% aload %%
23 (ab) -6 3 packedarray /aload [23 (ab) -6 [23 (ab) -6]] assert
0 /packedarray [[]] assert
    % aload errors
    /aload [/stackunderflow] assert
    (a) /aload [(a) /typecheck] assert


%% copy %%
/a1 1 2 3 3 packedarray def a1 dup length 1 add array /copy [[1 2 3]] assert
    % copy errors
    1 (2) 3 3 packedarray [4 5] /copy [[1 (2) 3] [4 5] /rangecheck] assert
    1 (2) 3 3 packedarray 4 5 6 3 packedarray /copy [[1 (2) 3] [4 5 6] /typecheck] assert
    1 (2) 3 3 packedarray true setglobal [4 5 6] false setglobal /copy [[1 (2) 3] [4 5 6] /invalidaccess] assert


%% forall %%
0 13 29 3 -8 21 5 packedarray {add} /forall [58] assert
1 2 3 4 5 5 packedarray {} /forall [1 2 3 4 5] assert
    % forall errors
    /forall [/stackunderflow] assert
    1 2 3 4 5 5 packedarray /forall [[1 2 3 4 5] /stackunderflow] assert
    1 {} /forall [1 {} /typecheck] assert
    1 2 3 4 5 5 packedarray 1 /forall [[1 2 3 4 5] 1 /typecheck] assert
