%!PS-Adobe-3.0
%%Title: Type 1 Font Tests
%%EndComments

% Load test framework if not already loaded
userdict /$unittest known not {(unit_tests/unittest.ps) run} if

% ============================================================
% Load Type 1 font via findfont (resource system loads .t1 file)
% ============================================================

% Test that the font has FontType 1
/NimbusRoman-Bold findfont /FontType get
[1] assert

% Test that FontMatrix exists and has 6 elements
/NimbusRoman-Bold findfont /FontMatrix get length
[6] assert

% Test that CharStrings dictionary exists
/NimbusRoman-Bold findfont /CharStrings known
[true] assert

% Test that Private dictionary exists
/NimbusRoman-Bold findfont /Private known
[true] assert

% Test that the font has an Encoding array of length 256
/NimbusRoman-Bold findfont /Encoding get length
[256] assert

% Test that CharStrings has .notdef
/NimbusRoman-Bold findfont /CharStrings get /.notdef known
[true] assert

% Test that CharStrings has common glyphs
/NimbusRoman-Bold findfont /CharStrings get /A known
[true] assert

/NimbusRoman-Bold findfont /CharStrings get /space known
[true] assert

/NimbusRoman-Bold findfont /CharStrings get /B known
[true] assert

/NimbusRoman-Bold findfont /CharStrings get /period known
[true] assert

% CharStrings has many glyphs (NimbusRoman is a full font)
/NimbusRoman-Bold findfont /CharStrings get length 50 gt
[true] assert

% Font dictionary has FID of type fontID (inserted by definefont per PLRM)
/NimbusRoman-Bold findfont /FID known
[true] assert

/NimbusRoman-Bold findfont /FID {get type} [/fonttype] assert

% ============================================================
% Type 1 Private dict — hinting keys
% ============================================================

% Private dict is noaccess (Type 1 font security) — verify it exists as a dict
/NimbusRoman-Bold findfont /Private get type /dicttype eq
[true] assert

% ============================================================
% scalefont / makefont
% ============================================================

% Test scalefont preserves FontType 1
/NimbusRoman-Bold findfont 12 scalefont
/FontType get
[1] assert

% Test makefont preserves FontType 1
/NimbusRoman-Bold findfont [0.012 0 0 0.012 0 0] makefont
/FontType get
[1] assert

% ============================================================
% stringwidth
% ============================================================

% Set up font for width testing
/NimbusRoman-Bold findfont 12 scalefont setfont

% Test stringwidth returns non-zero width for 'A'
(A) stringwidth pop 0 gt
[true] assert

% Space should have non-zero width
( ) stringwidth pop 0 gt
[true] assert

% Multiple characters should have larger width than single
(Hello) stringwidth pop
(H) stringwidth pop
gt
[true] assert

% 'M' should be wider than 'i' (proportional font)
(M) stringwidth pop
(i) stringwidth pop
gt
[true] assert

% Space should be narrower than 'M'
( ) stringwidth pop
(M) stringwidth pop
lt
[true] assert

% Y-component of stringwidth should be 0 for horizontal font
(Hello) stringwidth exch pop 0 eq
[true] assert

% Empty string has zero width
() stringwidth pop 0 eq
[true] assert

% Proportional scaling: 24pt width should be 2x 12pt width
/NimbusRoman-Bold findfont 12 scalefont setfont
(Test) stringwidth pop
/NimbusRoman-Bold findfont 24 scalefont setfont
(Test) stringwidth pop
exch 2 mul sub abs 0.01 lt
[true] assert

% ============================================================
% show (rendering)
% ============================================================

% Set up for rendering
/NimbusRoman-Bold findfont 24 scalefont setfont

% Test show doesn't crash
100 700 moveto
(Hello, Type 1 World!) show

% Test currentpoint advances after show
100 650 moveto
(Test) show
currentpoint pop
% x should have advanced past 100
100 gt
[true] assert

% currentfont returns Type 1 font after setfont
/NimbusRoman-Bold findfont 12 scalefont setfont
currentfont /FontType get
[1] assert

% show with empty string doesn't advance currentpoint
gsave
100 400 moveto
() show
currentpoint pop 100 sub abs 0.01 lt
[true] assert
grestore

% ============================================================
% ashow / widthshow
% ============================================================

/NimbusRoman-Bold findfont 12 scalefont setfont

% ashow should advance further than plain show for same string
gsave
100 700 moveto
(Test) show
currentpoint pop
grestore
gsave
100 700 moveto
1 0 (Test) ashow
currentpoint pop
grestore
lt   % show_x < ashow_x
[true] assert

% widthshow with space adjustment advances further than show
gsave
100 600 moveto
(Hello World) show
currentpoint pop
grestore
gsave
100 600 moveto
2 0 32 (Hello World) widthshow
currentpoint pop
grestore
lt   % show_x < widthshow_x
[true] assert

% ============================================================
% charpath
% ============================================================

newpath
100 450 moveto
(ABC) false charpath

% Path should exist (pathbbox should succeed)
% pathbbox returns: llx lly urx ury — verify urx > llx (non-empty path)
pathbbox  % llx lly urx ury
pop exch pop  % llx urx
lt  % llx < urx (i.e. path has width)
[true] assert

% Clean up
newpath

% ============================================================
% findfont fallback
% ============================================================

% findfont for non-existent font should fall back (not crash)
{ /NonExistentFont12345 findfont pop } stopped [false] assert
